---
title: "LinkedinJobs"
output: html_notebook
---

### Bibliotecas
- Rvest
- Httr
- Tydeverse
```{r, include=F}
if(!require("httr")) install.packages("httr")
if(!require("rvest")) install.packages("rvest")
if(!require("tidyverse")) install.packages("tidyverse")
```

## DataFrame

**Informacoes para coletar**

- Titulo da vaga
- Localidade da vaga
- Nome da empresa
- Data de postagem da vaga
- Link de referencia
- Descricao da vaga
- Plataforma utilizada para processo de candidatura
- Foto da empresa
- Numero de candidaturas
- Nivel da vaga
- Tipo de contrato

```{r}
vagas <- data.frame(Titulo = "", 
                    Localidade = "",
                    Noma_da_empresa = "",
                    Data_de_postagem = "",
                    Href = "",
                    Foto_da_empresa = "",
                    Numero_de_candidaturas = "",
                    Descricao.raw = "",
                    Nivel = "",
                    Tipo = "")
vagas
```


## Buscador de vagas

**Desafios atuais**

- Cada sessao retorna no maximo 25 vagas. 
- Entender os formularios da nova sessao.

**Problemas atuais** 

- A referencia ul 13 para buscar as listas, pode sofrer alteracoes dependendo da sessao retornada, entao deve-se utilizar o xpath. **Resolvido**
```{r}

linkedin <- html_session("https://www.linkedin.com/jobs")


formulario <- html_form(linkedin)[[3]]
formulario$fields$keywords$value <- "python"
formulario$fields$location$value <- "rio de janeiro"

linkedin <- submit_form(linkedin, formulario)

vagas_ <- html_nodes(linkedin, "ul")[13] %>%
          html_nodes("li")
vagas_
```

### Function Buscador anonimo
```{r}

Buscador <- function(Vaga, Local) {
              sessao <- html_session("https://www.linkedin.com/jobs")
              
              formulario <- html_form(sessao)[[3]]
              formulario$fields$keywords$value <- Vaga
              formulario$fields$location$value <- Local
              
              sessao <- submit_form(sessao, formulario)
              
              return(sessao)
}

sessao <- Buscador("analista de dados", "Rio de janeiro")
```

## Extraindo dados

CHECK LIST

- Nome da vaga :)
- Localidade da vaga :) 
- Nome da empresa :)
- Link de referencia Href :)
- Descricao da vaga :)
- Foto da empresa :)
- Plataforma utilizada para processo de candidatura
- Numero de candidaturas :)
- Nivel da vaga :)
- Tipo de contrato :)
```{r}
vagas <- html_nodes(sessao, xpath = "/html/body/main/div/section[2]/ul/li")



nome <- html_node(vagas, "a span") %>% html_text()
local <- html_node(vagas, "div span") %>% html_text()
empresa <- html_node(vagas, "div h4 a") %>% html_text()
link <- html_node(vagas, "a") %>% html_attr("href")
tempo <- html_node(vagas, "time") %>% html_text()

href <- GET(link[4]) %>% 
          read_html()  

foto <- html_nodes(href, "a img") %>% html_attr("data-delayed-url")
candidaturas <- html_nodes(href, "h3 span")[4] %>% html_text()
descricao.raw <- html_nodes(href, "section div section div")[14]
nivel <- html_nodes(href, "li span")[3] %>% html_text()
tipo <- html_nodes(href, "li span")[4] %>% html_text()

```

## Minerador
```{r}

Minerador <- function(){
                formulario <- html_form(sessao)[[4]]
              
}
```

```{r}
formulario <- html_form(sessao)[[4]]

formulario$fields$sortBy$value
```


### Formulario para estudar

**Entender a lista [[4]]**

- Seguimento 1: Relevante | Recente
- Seguimento 2: Ultimas 24 horas | Ultima semana | Ultimo mes | Qualquer momento
- Seguimento 3  Empresa
- Seguimento 4: Localidade
- Seguimento 5: Tempo Integral | Outro | Estagio | Contrato | Meio periodo
- Seguimento 6: Pleno Senior | Assistente | Junior | Estagio | Diretor

```{r}
formulario.novo <- html_form(linkedin)
formulario.novo[[4]]
```

```{r}
str.formulario <- c("<button button> '<unnamed>
                     <input radio> 'sortBy': R
                     <input radio> 'sortBy': DD
                     <button submit> '<unnamed>",
  
                    "<button button> '<unnamed>
                     <input radio> 'f_TP': 1
                     <input radio> 'f_TP': 1,2
                     <input radio> 'f_TP': 1,2,3,4
                     <input radio> 'f_TP': 
                     <button submit> '<unnamed>",
  
                    "<button button> '<unnamed>
                     <input text> 'value':",
  
                    "<button button> '<unnamed>
                     <input checkbox> 'f_C': 5231945
                     <input checkbox> 'f_C': 205811
                     <input checkbox> 'f_C': 1035
                     <input checkbox> 'f_C': 16161956
                     <input checkbox> 'f_C': 2271100
                     <button submit> '<unnamed>",
  
                    "<button button> '<unnamed>
                     <input text> 'value':",
  
                    "<button button> '<unnamed>
                     <input checkbox> 'f_PP': 106701406
                     <input checkbox> 'f_PP': 105272189
                     <input checkbox> 'f_PP': 100177287
                     <input checkbox> 'f_PP': 103553339
                     <input checkbox> 'f_PP': 105013179
                     <button submit> '<unnamed>",
  
                    "<button button> '<unnamed>
                     <input checkbox> 'f_JT': F
                     <input checkbox> 'f_JT': O
                     <input checkbox> 'f_JT': I
                     <input checkbox> 'f_JT': C
                     <button submit> '<unnamed>",
  
                    "<button button> '<unnamed>
                     <input checkbox> 'f_E': 4
                     <input checkbox> 'f_E': 2
                     <input checkbox> 'f_E': 3
                     <input checkbox> 'f_E': 1
                     <input checkbox> 'f_E': 5
                     <button submit> '<unnamed>")

str.formulario
```



